# fetch_data.py — сбор данных Stack Overflow по тегам

Скрипт `fetch_data.py` собирает количество новых вопросов на Stack Overflow по выбранным тегам и сохраняет результат в CSV, агрегированный **по календарным датам**.

Источник данных: Stack Exchange API (`/2.3/questions`), сайт `stackoverflow`.

---

## Что делает скрипт

1. Для каждого тега из `--tags` запрашивает вопросы, отсортированные по времени создания.
2. Берёт вопросы за период **от `N` месяцев назад** до **`M` месяцев назад** (в UTC).
3. Агрегирует количество вопросов по схеме:
   - `date` (YYYY-MM-DD)
   - `tag`
   - `questions_count`
4. Записывает данные в CSV.

---

## Требования

- Python 3.9+ (рекомендуется)
- Библиотека `requests`

Установка зависимостей:

```bash
pip install requests
```

---

## Запуск

Базовый пример:

```bash
python fetch_data.py --tags python java javascript
```

По умолчанию файл будет сохранён в:

```text
data/questions_by_date.csv
```

Полный пример с параметрами:

```bash
python fetch_data.py \
  --tags python java javascript \
  --out data/questions_by_date.csv \
  --months-from 6 \
  --months-to 2 \
  --max-pages 50
```

---

## Параметры командной строки

- `--tags` *(обязательно)*  
  Список тегов Stack Overflow.

- `--out` *(по умолчанию: `data/questions_by_date.csv`)*  
  Путь к выходному CSV-файлу.

- `--months-from` *(по умолчанию: `6`)*  
  Сколько месяцев назад начинается период.

- `--months-to` *(по умолчанию: `2`)*  
  Сколько месяцев назад заканчивается период.

- `--max-pages` *(по умолчанию: `50`)*  
  Ограничение страниц на тег (`max_pages × 100` вопросов).

---

## Как считается период

Период задаётся относительно текущего момента `now` в UTC:

- `start_dt = now - months_from`
- `end_dt = now - months_to`

Правая граница включается целиком за счёт использования полуинтервала:

```
[start_dt, end_dt + 1 day)
```

---

## Формат выходного файла

```csv
date,tag,questions_count
2025-09-14,python,9
2025-09-14,java,5
2025-09-14,javascript,5
```

---

## Поведение при лимитах API

- Учитывается `backoff` от API.
- При `quota_remaining = 0` выполнение для текущего тега прекращается.

---

## Использование в DataLens

CSV готов для загрузки в BI-инструменты.
Агрегации по неделям, дням недели и скользящие средние выполняются на уровне DataLens.
